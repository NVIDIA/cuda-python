# SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0

[project]
name = "cuda-pathfinder"
description = "Pathfinder for CUDA components"
authors = [{ name = "NVIDIA Corporation", email = "cuda-python-conduct@nvidia.com" }]
license = "Apache-2.0"
requires-python = ">=3.9"
dynamic = ["version"]
dependencies = []

[project.optional-dependencies]
test = [
    "pytest>=6.2.4",
]
nvidia_wheels_cu12 = [
    "cuda-toolkit[cublas]==12.*",
    "cuda-toolkit[nvcc]==12.*",
    "cuda-toolkit[nvrtc]==12.*",
    "cuda-toolkit[cudart]==12.*",
    "cuda-toolkit[cufft]==12.*",
    "cuda-toolkit[cufile]==12.*; sys_platform != 'win32'",
    "cuda-toolkit[curand]==12.*",
    "cuda-toolkit[cusolver]==12.*",
    "cuda-toolkit[cusparse]==12.*",
    "cuda-toolkit[npp]==12.*",
    "cuda-toolkit[nvfatbin]==12.*",
    "cuda-toolkit[nvjitlink]==12.*",
    "cuda-toolkit[nvjpeg]==12.*",
]
nvidia_wheels_cu13 = [
    "cuda-toolkit[cublas]==13.*",
    "cuda-toolkit[nvcc]==13.*",
    "cuda-toolkit[nvrtc]==13.*",
    "cuda-toolkit[cudart]==13.*",
    "cuda-toolkit[cufft]==13.*",
    "cuda-toolkit[cufile]==13.*; sys_platform != 'win32'",
    "cuda-toolkit[curand]==13.*",
    "cuda-toolkit[cusolver]==13.*",
    "cuda-toolkit[cusparse]==13.*",
    "cuda-toolkit[npp]==13.*",
    "cuda-toolkit[nvfatbin]==13.*",
    "cuda-toolkit[nvjitlink]==13.*",
    "cuda-toolkit[nvjpeg]==13.*",
    "cuda-toolkit[nvvm]==13.*",
]

[project.urls]
Repository = "https://github.com/NVIDIA/cuda-python"
Documentation = "https://nvidia.github.io/cuda-python/"

[tool.setuptools]
packages = { find = { include = ["cuda*"] } }

[tool.setuptools.dynamic]
version = { attr = "cuda.pathfinder._version.__version__" }
readme = { file = ["DESCRIPTION.rst"], content-type = "text/x-rst" }

[build-system]
requires = ["setuptools>=64", "wheel"]
build-backend = "setuptools.build_meta"

[tool.ruff]
line-length = 120
preview = true

[tool.ruff.format]
docstring-code-format = true

[tool.ruff.lint]
select = [
    "E",     # pycodestyle Error
    "F",     # Pyflakes
    "W",     # pycodestyle Warning
    "UP",    # pyupgrade
    "B",     # flake8-bugbear
    "SIM",   # flake8-simplify
    "I",     # isort
    "ARG",   # flake8-unused-arguments
    "Q",     # flake8-quotes
    "N",     # pep8-naming
    "C4",    # flake8-comprehensions
    "PIE",   # flake8-pie
    "T20",   # flake8-print
    "RUF",   # Ruff-specific rules
    "PT",    # flake8-pytest-style
    "DTZ",   # flake8-datetimez
]
extend-select = ["B9"]

[tool.ruff.lint.flake8-quotes]
inline-quotes = "double"

[tool.ruff.lint.per-file-ignores]
"tests/**/*" = ["S101"]

[tool.mypy]
# Basic settings
python_version = "3.9"
explicit_package_bases = true
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true

# Start strict, but allow some flexibility
check_untyped_defs = true
disallow_any_generics = true
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true

# Allow some common patterns to keep it simple
allow_redefinition = true
implicit_reexport = true

# Ignore missing imports for now (you can tighten this later)
ignore_missing_imports = true

# Only check your package
[[tool.mypy.overrides]]
module = "cuda.pathfinder.*"
disallow_untyped_defs = true

# Be more lenient with test files
[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false
ignore_errors = true
